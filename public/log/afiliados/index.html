<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administraci√≥n de Afiliados</title>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <div class="admin-container">
        <header class="header">
            <div class="header-content">
                <h1>üè≠ Gesti√≥n de Afiliados</h1>
                <p>Sistema de control de altas, bajas y reingresos</p>
            </div>
            <button class="btn-logout" id="btnCerrarSesion">Cerrar Sesi√≥n</button>
        </header>

        <div class="main-content">
            <!-- Estad√≠sticas -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-info">
                        <h3 id="totalActivos">0</h3>
                        <p>Activos</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è∏Ô∏è</div>
                    <div class="stat-info">
                        <h3 id="totalBajas">0</h3>
                        <p>Dados de Baja</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üîÑ</div>
                    <div class="stat-info">
                        <h3 id="totalReingresos">0</h3>
                        <p>Reingresos</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üåü</div>
                    <div class="stat-info">
                        <h3 id="totalPlanta">0</h3>
                        <p>Con Planta</p>
                    </div>
                </div>
                <div class="stat-card stat-card-pending">
                    <div class="stat-icon">‚è≥</div>
                    <div class="stat-info">
                        <h3 id="totalPendientes">0</h3>
                        <p>Solicitudes Pendientes</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üö´</div>
                    <div class="stat-info">
                        <h3 id="totalDespidos">0</h3>
                        <p>Despidos</p>
                    </div>
                </div>
            </div>

            <!-- Pesta√±as de navegaci√≥n -->
            <div class="tabs-navigation">
                <button class="tab-btn active" data-tab="afiliados">
                    Afiliados Aprobados
                </button>
                <button class="tab-btn" data-tab="pendientes">
                    Solicitudes Pendientes <span class="badge-count" id="badgePendientes">0</span>
                </button>
            </div>

            <!-- Filtros y b√∫squeda -->
            <div class="filters-section" id="filtrosAfiliados">
                <h2>Filtros de B√∫squeda</h2>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label>Buscar por nombre o CURP:</label>
                        <input type="text" id="searchInput" placeholder="Escribe para buscar...">
                    </div>
                    
                    <div class="filter-group">
                        <label>Estado:</label>
                        <select id="filterStatus">
                            <option value="">Todos</option>
                            <option value="A">Activos (A)</option>
                            <option value="B">Dados de Baja (B)</option>
                            <option value="R">Reingresos (R)</option>
                            <option value="AP">Alta Planta (AP)</option>
                            <option value="D">Despidos (D)</option>
                            <option value="PUEDE_PLANTA">Ya cumplieron 24+ meses (referencia)</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>Mes de primera alta:</label>
                        <select id="filterMes">
                            <option value="">Todos</option>
                            <option value="0">Enero</option>
                            <option value="1">Febrero</option>
                            <option value="2">Marzo</option>
                            <option value="3">Abril</option>
                            <option value="4">Mayo</option>
                            <option value="5">Junio</option>
                            <option value="6">Julio</option>
                            <option value="7">Agosto</option>
                            <option value="8">Septiembre</option>
                            <option value="9">Octubre</option>
                            <option value="10">Noviembre</option>
                            <option value="11">Diciembre</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>A√±o de primera alta:</label>
                        <input type="number" id="filterAnio" placeholder="Ej: 2026" min="2020" max="2030">
                    </div>

                    <div class="filter-group">
                        <label>Tiempo desde baja:</label>
                        <select id="filterTiempoBaja">
                            <option value="">Todos</option>
                            <option value="6+">6+ meses (Pueden reingresar)</option>
                            <option value="3-6">3-6 meses</option>
                            <option value="0-3">0-3 meses</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>Ordenar por:</label>
                        <select id="sortBy">
                            <option value="fechaAlta-desc">Fecha de alta (m√°s reciente)</option>
                            <option value="fechaAlta-asc">Fecha de alta (m√°s antigua)</option>
                            <option value="nombre-asc">Nombre (A-Z)</option>
                            <option value="nombre-desc">Nombre (Z-A)</option>
                        </select>
                    </div>
                </div>

                <div class="filter-actions">
                    <button class="btn-primary" id="btnAplicarFiltros">Aplicar Filtros</button>
                    <button class="btn-secondary" id="btnLimpiarFiltros">Limpiar Filtros</button>
                </div>
            </div>

            <!-- Tabla de afiliados -->
            <div class="table-section" id="seccionAfiliados">
                <div class="table-header">
                    <h2>Lista de Afiliados Aprobados</h2>
                    <div class="table-actions">
                        <span id="resultCount">0 resultados</span>
                    </div>
                </div>

                <div class="table-container">
                    <table id="tablaAfiliados">
                        <thead>
                            <tr>
                                <th>Foto</th>
                                <th>Nombre</th>
                                <th>CURP</th>
                                <th>Puesto</th>
                                <th>Estado</th>
                                <th>Fecha Ingreso Empresa</th>
                                <th>Tiempo Activo</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaBody">
                            <tr>
                                <td colspan="8" class="loading-row">
                                    <div class="spinner-small"></div>
                                    Cargando datos...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tabla de solicitudes pendientes -->
            <div class="table-section hidden" id="seccionPendientes">
                <div class="table-header">
                    <h2>Solicitudes Pendientes de Aprobaci√≥n</h2>
                    <div class="table-actions">
                        <span id="pendientesCount">0 solicitudes</span>
                    </div>
                </div>

                <div class="table-container">
                    <table id="tablaPendientes">
                        <thead>
                            <tr>
                                <th>Foto</th>
                                <th>Nombre</th>
                                <th>CURP</th>
                                <th>Puesto</th>
                                <th>Tel√©fono</th>
                                <th>Fecha Solicitud</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaPendientesBody">
                            <tr>
                                <td colspan="7" class="loading-row">
                                    <div class="spinner-small"></div>
                                    Cargando solicitudes...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para ver detalles -->
    <div id="modalDetalles" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Detalles del Afiliado</h2>
                <button class="close-btn" onclick="closeModal('modalDetalles')">&times;</button>
            </div>
            <div id="detallesContent" class="modal-body">
                <!-- Se llenar√° din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Modal para dar de baja -->
    <div id="modalBaja" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Dar de Baja</h2>
                <button class="close-btn" onclick="closeModal('modalBaja')">&times;</button>
            </div>
            <div class="modal-body">
                <p>Est√°s a punto de dar de baja a:</p>
                <p class="highlight-name" id="nombreBaja"></p>
                
                <div class="form-group">
                    <label>Motivo de la baja: <span class="required">*</span></label>
                    <textarea id="motivoBaja" rows="4" placeholder="Describe el motivo de la baja..." required></textarea>
                </div>

                <div class="modal-buttons">
                    <button class="btn-danger" id="btnConfirmarBaja">Dar de Baja</button>
                    <button class="btn-secondary" onclick="closeModal('modalBaja')">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para reingreso -->
    <div id="modalReingreso" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reingreso de Afiliado</h2>
                <button class="close-btn" onclick="closeModal('modalReingreso')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="reingresoInfo"></div>
                <div class="modal-buttons">
                    <button class="btn-success" id="btnConfirmarReingreso">Confirmar Reingreso</button>
                    <button class="btn-secondary" onclick="closeModal('modalReingreso')">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para otorgar planta -->
    <div id="modalPlanta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üåü Otorgar Planta</h2>
                <button class="close-btn" onclick="closeModal('modalPlanta')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="plantaInfo"></div>
                <div class="modal-buttons">
                    <button class="btn-success" id="btnConfirmarPlanta">Otorgar Planta</button>
                    <button class="btn-secondary" onclick="closeModal('modalPlanta')">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar afiliado -->
    <div id="modalEditar" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>‚úèÔ∏è Editar Datos del Afiliado</h2>
                <button class="close-btn" onclick="closeModal('modalEditar')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formEditar" onsubmit="event.preventDefault(); guardarEdicion();">
                    
                    <h3 class="section-title">Datos Personales</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre Completo: <span class="required">*</span></label>
                            <input type="text" id="editNombreCompleto" required>
                        </div>
                    </div>

                    <div class="form-row two-cols">
                        <div class="form-group">
                            <label>CURP: <span class="required">*</span></label>
                            <input type="text" id="editCurp" maxlength="18" style="text-transform: uppercase;" required>
                        </div>
                        <div class="form-group">
                            <label>Tel√©fono: <span class="required">*</span></label>
                            <input type="tel" id="editTelefono" pattern="[0-9]{10}" placeholder="10 d√≠gitos" required>
                        </div>
                    </div>

                    <div class="form-row two-cols">
                        <div class="form-group">
                            <label>Lugar de Nacimiento:</label>
                            <input type="text" id="editLugarNacimiento">
                        </div>
                        <div class="form-group">
                            <label>Fecha de Nacimiento:</label>
                            <input type="date" id="editFechaNacimiento">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Domicilio:</label>
                            <input type="text" id="editDomicilio">
                        </div>
                    </div>

                    <div class="form-row three-cols">
                        <div class="form-group">
                            <label>Estado Civil:</label>
                            <select id="editEstadoCivil">
                                <option value="Soltero(a)">Soltero(a)</option>
                                <option value="Casado(a)">Casado(a)</option>
                                <option value="Uni√≥n Libre">Uni√≥n Libre</option>
                                <option value="Divorciado(a)">Divorciado(a)</option>
                                <option value="Viudo(a)">Viudo(a)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Sexo:</label>
                            <select id="editSexo">
                                <option value="Masculino">Masculino</option>
                                <option value="Femenino">Femenino</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Escolaridad:</label>
                            <select id="editEscolaridad">
                                <option value="Primaria">Primaria</option>
                                <option value="Secundaria">Secundaria</option>
                                <option value="Preparatoria">Preparatoria</option>
                                <option value="Carrera T√©cnica">Carrera T√©cnica</option>
                                <option value="Licenciatura">Licenciatura</option>
                                <option value="Posgrado">Posgrado</option>
                            </select>
                        </div>
                    </div>

                    <h3 class="section-title">Datos Laborales</h3>

                    <div class="form-row two-cols">
                        <div class="form-group">
                            <label>Puesto:</label>
                            <select id="editPuesto">
                                <option value="Ayudante General B">Ayudante General B</option>
                                <option value="Ayudante General A">Ayudante General A</option>
                                <option value="Fabricante B">Fabricante B</option>
                                <option value="Fabricante A">Fabricante A</option>
                                <option value="Mec√°nico / Utilities">Mec√°nico / Utilities</option>
                                <option value="Operador">Operador</option>
                                <option value="Porteador">Porteador</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Salario Diario:</label>
                            <input type="number" id="editSalarioDiario" step="0.01" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Fecha de Ingreso a la Empresa:</label>
                            <input type="date" id="editFechaIngresoEmpresa">
                        </div>
                    </div>

                    <h3 class="section-title">Fotograf√≠a</h3>

                    <div id="fotoActualPreview"></div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Cambiar Foto (opcional):</label>
                            <input type="file" id="editFoto" accept="image/jpeg,image/jpg,image/png">
                            <small>Formatos: JPG, JPEG, PNG (m√°x. 5MB)</small>
                            <div id="editFotoPreview"></div>
                        </div>
                    </div>

                    <div class="alert-box alert-warning">
                        <strong>‚ö†Ô∏è Importante:</strong> Los cambios en los datos personales, laborales o la foto se guardar√°n permanentemente. Aseg√∫rate de que la informaci√≥n sea correcta antes de guardar.
                    </div>

                    <div class="modal-buttons">
                        <button type="submit" class="btn-success">üíæ Guardar Cambios</button>
                        <button type="button" class="btn-secondary" onclick="closeModal('modalEditar')">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de confirmaci√≥n -->
    <div id="modalConfirm" class="modal">
        <div class="modal-content small">
            <div class="modal-header">
                <h2>Confirmaci√≥n</h2>
            </div>
            <div class="modal-body">
                <p id="confirmMessage"></p>
                <div class="modal-buttons">
                    <button class="btn-primary" id="btnConfirmYes">S√≠, continuar</button>
                    <button class="btn-secondary" id="btnConfirmNo">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCcBqpSXsz_wqm3xyg0NSJYnvQTK0NhkXg",
            authDomain: "formatovacaciones.firebaseapp.com",
            projectId: "formatovacaciones",
            storageBucket: "formatovacaciones.firebasestorage.app",
            messagingSenderId: "753669687689",
            appId: "1:753669687689:web:b37af5de6ba6b1391ef958",
            measurementId: "G-LMKRM8VKM7"
        };

        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
    </script>
    
    <script type="module" src="admin.js"></script>
</body>
</html>